---
title: "Mortality"
author: "Stefan Schmidt"
date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(lubridate)
library(plotly)
library(shiny)

url_node = "https://raw.githubusercontent.com"
url_dir = "/qualityland/JHU_DataViz_in_R/main/05_data_viz_capstone/data/"
url_file = "mortality_2022-08-11.csv"
data_file = paste0(url_node, url_dir, url_file)
df <- read_csv(url(data_file))
#df <- read_csv("data/mortality_2022-08-11.csv")

countries <- df %>%
  select(Country) %>% 
  unique() %>% 
  arrange(Country)
```

CDR
======

Input{.sidebar}
----------------------------------------------------------------

```{r}
selectInput(
  inputId = "cdrCountries",
  label = "Select countries:",
  choices = countries,
  selected = c("Germany", "Switzerland", "Italy", "France"),
  multiple = TRUE)
```


Column{data-height=750}
----------------------------------------------------------------

### Crude Death Rate

```{r}
renderPlot(
  df %>% 
  filter(Country %in% input$cdrCountries) %>% 
  mutate(
    population = DTotal / RTotal,
    Year = ymd(Year, truncated = 2)) %>% 
  group_by(Year, Country) %>% 
  summarise(CDR = sum(DTotal) / sum(population) * 10^3, .groups = "drop") %>% 
  ggplot(aes(x = Year, y = CDR, color = Country)) +
  geom_line(size = 1) +
  labs(
    title = "Deaths per Year and 1000 Inhabitants",
    y = "deaths / year per 1000")
)
```

Weekly Death Rate
======

Input{.sidebar}
----------------------------------------------------------------

```{r}
selectInput(
  inputId = "wdrCountry",
  label = "Select country:",
  choices = countries,
  selected = "Switzerland")

selectInput(
  inputId = "wdrYears",
  label = "Select years:",
  choices = 2016:2022,
  selected = 2022,
  multiple = TRUE)
```


Column{data-height=750}
----------------------------------------------------------------

### Weekly Death Rate

```{r}
renderPlot(
  df %>% 
  filter(Year %in% input$wdrYears, Country == input$wdrCountry) %>% 
  mutate(Year = factor(Year)) %>% 
  group_by(Year, Country) %>% 
  ggplot(aes(x = Week, y = RTotal * 10^3, color = Year)) +
  geom_line() +
  labs(
    title="Deaths per Week and 1000 Inhabitants",
    x="Week of the Year",
    y="deaths / week per 1000")
)
```


Page 1 {data-orientation=columns}
===================================== 

Column
-------    

### Chart B

```{r}

```

Column
-------    

### Chart C

```{r}
```




Page 2
======

### Switzerland


```{r}
df %>% 
  filter(Year > 2018, CountryCode == "CHE") %>% 
  mutate(Year = factor(Year)) %>% 
  group_by(Year, CountryCode) %>% 
  ggplot(aes(x = Week, y = DTotal, color = Year)) +
  geom_line() +
  labs(
    title="Mortality in Switzerland",
    x="Week of the Year",
    y="Number of Deaths")
```



